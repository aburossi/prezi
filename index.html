<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #header {
            background: #333;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 1.2em;
        }
        #viewer-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }
        #slide-frame {
            width: 95%;
            height: 90%;
            border: none;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        #controls {
            background: #333;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        button {
            background: #555;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        button:hover {
            background: #666;
        }
        button:disabled {
            background: #333;
            color: #777;
            cursor: not-allowed;
        }
        #slide-info {
            font-size: 1em;
        }
        #progress-container {
            flex: 1;
            height: 5px;
            background: #444;
            margin: 0 20px;
            border-radius: 5px;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            background: #f00;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="slide-info">Loading presentation...</div>
    </div>
    
    <div id="viewer-container">
        <iframe id="slide-frame" src="about:blank"></iframe>
    </div>
    
    <div id="controls">
        <button id="prev-btn" disabled>← Previous</button>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <button id="next-btn" disabled>Next →</button>
    </div>

    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const folder = urlParams.get('folder') || 'slides'; // Default folder name
        
        // DOM elements
        const slideFrame = document.getElementById('slide-frame');
        const slideInfo = document.getElementById('slide-info');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        
        // State
        let currentSlide = 1;
        let totalSlides = 0;
        let isLoading = true;
        
        // Initialize
        function init() {
            // Set up event listeners
            prevBtn.addEventListener('click', prevSlide);
            nextBtn.addEventListener('click', nextSlide);
            document.addEventListener('keydown', handleKeyDown);
            
            // Detect number of slides in folder
            detectTotalSlides().then(count => {
                totalSlides = count;
                if (totalSlides > 0) {
                    isLoading = false;
                    updateControls();
                    loadCurrentSlide();
                } else {
                    slideInfo.textContent = `No slides found in ${folder} folder`;
                }
            }).catch(error => {
                slideInfo.textContent = `Error loading slides from ${folder} folder`;
                console.error(error);
            });
        }
        
        // Detect total number of slides by checking sequentially
        function detectTotalSlides() {
            return new Promise((resolve) => {
                let count = 0;
                let maxChecks = 100; // Maximum number of slides to check
                let checksDone = 0;
                
                function checkSlideExists(slideNumber) {
                    fetch(`${folder}/${slideNumber}.html`)
                        .then(response => {
                            if (response.ok) {
                                count = slideNumber;
                                checkSlideExists(slideNumber + 1);
                            } else {
                                resolve(count);
                            }
                        })
                        .catch(() => resolve(count))
                        .finally(() => {
                            checksDone++;
                            if (checksDone >= maxChecks) resolve(count);
                        });
                }
                
                checkSlideExists(1);
            });
        }
        
        // Load current slide
        function loadCurrentSlide() {
            if (isLoading) return;
            
            slideFrame.src = `${folder}/${currentSlide}.html`;
            updateInfo();
            updateUrl();
        }
        
        // Navigation functions
        function prevSlide() {
            if (currentSlide > 1) {
                currentSlide--;
                loadCurrentSlide();
            }
        }
        
        function nextSlide() {
            if (currentSlide < totalSlides) {
                currentSlide++;
                loadCurrentSlide();
            }
        }
        
        // Handle keyboard navigation
        function handleKeyDown(e) {
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'ArrowRight') nextSlide();
        }
        
        // Update controls state
        function updateControls() {
            prevBtn.disabled = currentSlide <= 1 || isLoading;
            nextBtn.disabled = currentSlide >= totalSlides || isLoading;
        }
        
        // Update slide info
        function updateInfo() {
            slideInfo.textContent = `Slide ${currentSlide} of ${totalSlides}`;
            const progress = (currentSlide / totalSlides) * 100;
            progressBar.style.width = `${progress}%`;
            updateControls();
        }
        
        // Update URL without reload
        function updateUrl() {
            const newUrl = `${window.location.pathname}?folder=${folder}&slide=${currentSlide}`;
            window.history.pushState({}, '', newUrl);
        }
        
        // Handle back/forward navigation
        window.addEventListener('popstate', () => {
            const params = new URLSearchParams(window.location.search);
            const newSlide = parseInt(params.get('slide')) || 1;
            if (newSlide !== currentSlide) {
                currentSlide = newSlide;
                loadCurrentSlide();
            }
        });
        
        // Initialize
        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide Viewer</title>
    <style>
        /* Remove all margins and make the page full-screen */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Prevent any scrollbars on the main page */
        }
        /* Make the iframe fill the entire page seamlessly */
        #slide-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <iframe id="slide-frame" src="about:blank"></iframe>

    <script>
        // DOM element
        const slideFrame = document.getElementById('slide-frame');

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const folder = urlParams.get('folder') || 'slides';
        let currentSlide = parseInt(urlParams.get('slide')) || 1;

        /**
         * Loads the current slide into the iframe.
         * The #slide number in the URL is used by the slide content itself.
         */
        function loadCurrentSlide() {
            // The Reveal.js slides use the URL hash to go to a specific slide
            slideFrame.src = `${folder}/#/${currentSlide}`;
        }
        
        /**
         * Updates the browser's URL when the slide changes inside the iframe.
         */
        function updateUrl(slideNumber) {
            // Only update if the slide number has actually changed
            if (slideNumber === currentSlide) return;
            
            currentSlide = slideNumber;
            const newUrl = `${window.location.pathname}?folder=${folder}&slide=${currentSlide}`;
            // Use replaceState to avoid cluttering browser history
            window.history.replaceState({ slide: currentSlide }, '', newUrl);
        }

        /**
         * Listens for messages from the iframe.
         * The Reveal.js slides can be configured to "post" their state,
         * which allows us to sync the URL.
         */
        window.addEventListener('message', event => {
            // Security: Check if the message is from our iframe's content window
            if (event.source !== slideFrame.contentWindow) {
                return;
            }

            // The Reveal.js 'slidechanged' event data structure
            if (event.data && typeof event.data.indexh !== 'undefined') {
                const newSlideNumber = event.data.indexh + 1; // Reveal.js is 0-indexed, we use 1-indexed
                updateUrl(newSlideNumber);
            }
        });

        /**
         * Handles the browser's back/forward buttons.
         */
        window.addEventListener('popstate', () => {
            const params = new URLSearchParams(window.location.search);
            const slideFromUrl = parseInt(params.get('slide')) || 1;
            if (slideFromUrl !== currentSlide) {
                currentSlide = slideFromUrl;
                loadCurrentSlide();
            }
        });

        // Initial load
        loadCurrentSlide();
    </script>
</body>
</html>
